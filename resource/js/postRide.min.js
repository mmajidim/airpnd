function postARide(e,t){var n=$("#startLocationSelect").css("display")!="none"?$("option:selected","#startLocation").val():$("#startToLocation").val();var r=$("#toLocationInput").is(":visible")?$("#toLocation").val():$("option:selected","#toStartLocation").val();var i=$("#startLocationSelect").css("display")!="none"?AIRPORT_START:ADDRESS_START;var s=$.getDateTime.time($("#date").val());s=$.getDateTime.time(s,true);var o=$("#contributionPrice").html().split("$")[1];var u={ownerId:e.userInfoId,entityId:t,date:$.getDateTime.date($("#date").val()),time:s,start:n,to:r,startType:i,via:$("#viaLocation").val(),maxMiles:$("#locationRange").html().split(" ")[0],contribution:o,seats:$("#seats").val(),smoker:$("#smoker").is(":checked"),bags:$("#bagPostRide").val(),bagSize:$("#bagSizePostRide option:selected").val(),note:$("#rideNote").val()};var a={action:POST_A_RIDE,ride:JSON.stringify(u)};$.ajax({type:"POST",url:CUSTOM_API_URL,data:a,dataType:"json",headers:HEADER,async:false,error:function(e){$("#editRideLoader").addClass("hide");$("#postRide").removeAttr("disabled");showAlertBox("Error",ERROR_MSG)},success:function(e){$("#editRideLoader").addClass("hide");$("#postRide").removeAttr("disabled");if(e.retCode){showAlertBox("Successful","You have successfully posted a ride.",SITE_URL+"postRide.php")}}});moveTotop()}function getEntity(){var e;var t={action:GET_ENTITY_BY_NUMBER_ACTION,number:CAR_ENTITY};$.ajax({type:"POST",url:API_URL,data:t,dataType:"xml",async:false,headers:HEADER,error:function(e){showAlertBox("Error",ERROR_MSG);moveTotop()},success:function(t){$(t).find("response").each(function(){e=$(this).find("id").text()})}});return e}function showPreviousRides(){var e=sessionManager("getSession","customerId");if(e){var t=rideByCustomer(e);var n=t.rides==null||t.rides.length==1;loadPreviousRides(t);$("#postRidePanel").contentSlider("My Rides",n)}}function loadPreviousRides(e){var t="";if(e.retCode&&e.rides.length>0){e=sortByKey(e.rides,"dt","0");$.each(e,function(e,n){var r=$.getDateTime.formatDate(n.dt);var i=$.getDateTime.formatDateTime(n.dt);var s=n.startType==AIRPORT_START?"Airport":"Address";var o=n.startType==ADDRESS_START?"Airport":"Address";var u=n.smoker==1?"Yes":"No";var a=n.via==null||n.via==""?"NA":n.via;t+='<div><h2 class="title greenLabel">'+r+"</h2>";t+='<table class="table table-striped"><tbody>';t+="<tr><td>"+s+"</td><td>";t+=n.start+"</td></tr>";t+="<tr><td>"+o+"</td><td>"+n.to+"</td></tr>";t+="<td>Via</td><td>"+a+"</td></tr>";t+="<td>Date</td><td>"+i+"</td></tr>";t+="<tr><td>Available Seats</td><td>"+n.seats+"</td></tr>";t+="<tr><td>Contribution</td><td>"+n.contribution+" $"+"</td></tr>";t+="<tr><td>Within</td><td>";t+=n.maxMiles+" Miles</td></tr><tr><td>Status</td>";t+="<td>"+getRideStatusName(n.status)+"</td></tr>";t+="<tr><td>Bag Size</td><td>"+getBagSizeName(n.bagSize)+"</td></tr>";t+="<tr><td>Bags</td><td>"+n.bags+"</td></tr>";t+="<tr><td>Smoker</td><td>"+u+"</td></tr>";t+="<tr><td>Note</td><td>"+n.note+"</td></tr>";t+="</tr></tbody></table></div>"})}else{t='<div><h2 class="greenLabel">No ride is found.</h2></div>'}$("#postRidePanel").append(t)}function getRideStatusName(e){var t="";switch(e){case"0":t="Available";break;case"1":t="Pending";break;case"2":t="Full";break}return t}function addItem(){var e=-1;var t=getCategoryName(DRIVE);var n={info:{id:NO_ID,classId:t,pkgId:NO_ID,history:NO,lotId:NO_ID,autogen:YES,prefix:DRIVE,type:YES,level:YES,limit:NO,description:"",quantity:"",commissionable:YES,taxable:YES,active:YES,display:YES,sequence:NO,number:YES,name:DRIVE,priceType:FIXED_TYPE},features:""};var r={action:ADD_ITEM,item:JSON.stringify(n)};$.ajax({type:"POST",url:API_URL,data:r,dataType:"json",headers:HEADER,async:false,error:function(e){showAlertBox("Error",ERROR_MSG)},success:function(t){e=t}});return e}function addPrice(e,t){var n=-1;var r=[[t,t]];var i={action:ADD_PRICE,entityId:e,type:FIXED_TYPE,priceList:JSON.stringify(r)};$.ajax({type:"POST",url:API_URL,data:i,dataType:"json",headers:HEADER,async:false,error:function(e){showAlertBox("Error",ERROR_MSG)},success:function(e){n=e}});return n}function postRide(){var e=-1;var t=sessionManager("getSession","user");if(t){e=addItem();if(e.retCode){var n=e.itemId;e=addPrice(n,$("#contributionPrice").html().split("$")[1]||1);if(e.retCode){postARide(t,n)}}}}$(function(){function n(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);autocomplete.setBounds(new google.maps.LatLngBounds(t,t))})}}function r(){e=$("#startLocationSelect").css("display")!="none"?$("option:selected","#startLocation").val():$("option:selected","#toStartLocation").val();t=$("#toLocationInput").is(":visible")?$("#toLocation").val():$("#startToLocation").val();if(t.trim()!=""){$("#contribution").getSlider("contributionPrice",null,"$");var n=getPriceForRide(e,t,$("#locationRange").text().split(" ")[0]);$("#contribution").slider("option","max",n<=1?0:n);$("#contribution").slider("option","disabled",false);var r=$("#contribution").slider("value")<=1?"":$("#contribution").slider("value");$("#contributionPrice").html("$"+r);$("#maxPrice").html("$"+(n<=1?0:n))}}var e;var t;$(window).keydown(function(e){if(e.keyCode==13){e.preventDefault();return false}});$('[rel="tooltip"]').tooltip();$("#searchLocation").on("slidestop",function(n,r){e=$("#startLocationSelect").css("display")!="none"?$("option:selected","#startLocation").val():$("option:selected","#toStartLocation").val();t=$("#toLocationInput").is(":visible")?$("#toLocation").val():$("#startToLocation").val();if(t!=""){var i=getPriceForRide(e,t,r.value);$("#contribution").slider("option","max",i<=1?0:i);$("#contribution").slider("option","disabled",false);var s=$("#contribution").slider("value")<1?"":$("#contribution").slider("value");$("#contributionPrice").html("$"+s);$("#maxPrice").html("$"+(i<1?0:i))}});$("#contribution").on("slidestop",function(e,t){var n=t.value<=1?"$":"$"+t.value;$("#contributionPrice").html(n)});$("#bagSizePostRide").select2();$("#seats").select2();getSeats("seats");if($("#toLocationInput").css("display")!="none"){autocomplete=new google.maps.places.Autocomplete(document.getElementById("toLocation"),{types:["geocode"]})}autocomplete=new google.maps.places.Autocomplete(document.getElementById("startToLocation"),{types:["geocode"]});autocomplete=new google.maps.places.Autocomplete(document.getElementById("viaLocation"),{types:["geocode"]});google.maps.event.addListener(autocomplete,"place_changed",function(){});$("#toLocation,#startToLocation").keyup(function(e){n()});showPreviousRides();$(document).on("click",".exchange",function(){$("#startLocationSelect,#startLocationInput,#toLocationInput,#toLocationSelect").toggleClass("hide");$("#startLocationInput .postRideLocationInput,#toLocationInput .postRideLocationInput").toggleClass("ignore");var n=$("#startLocation option:selected").val();var r=$("#toLocation").val();var i=$("#toStartLocation option:selected").val();var s=$("#startToLocation").val();$("#startToLocation").val(r);$("#toStartLocation").select2("val",n);$("#startLocation").select2("val",i);$("#toLocation").val(s);if(!$("#startToLocation").hasClass("ignore")){$("#startLabel").html("Address");$("#toLabel").html("Airport")}else{$("#startLabel").html("Airport");$("#toLabel").html("Address")}e=$("#startLocationSelect").css("display")!="none"?$("option:selected","#startLocation").val():$("option:selected","#toStartLocation").val();t=$("#toLocationInput").is(":visible")?$("#toLocation").val():$("#startToLocation").val();return false});$(document).on("change","#startLocation,#toLocation,#startToLocation,#toStartLocation",function(e){setTimeout(function(){r()},300);return false});$("#toLocation,#startToLocation").on("keyup",function(e){if(e.keyCode==13){$(this).blur()}if($(this).val().trim()==""){$("#contribution").slider("option","disabled",true);$("#contribution").slider("value",0);$("#maxPrice").text("$");$("#contributionPrice").text("$")}});$("#toLocation,#startToLocation").on("blur",function(e){if($(this).val().trim()==""){$("#contribution").slider("option","disabled",true);$("#contribution").slider("value",0);$("#maxPrice").text("$");$("#contributionPrice").text("$")}});var i=[{id:"postRide"},{id:"myBookingsPostRide"}];toggleSection(i);getLocation("startLocation",true);getLocation("toStartLocation ",true);getBagTypes("bagSizePostRide");$("#toLocation").filterType("special");$("#viaLocation").filterType("special");$("#seats").filterType("numeric");$(".icon-minus-sign, .icon-plus-sign").on("click",function(){$(this).toggleClass("icon-minus-sign icon-plus-sign");$("#postRidePanel-wrapper").slideToggle(200,"linear")});$("#date").dateTimePicker();$("#date").on("click",function(){$(this).next(".popover").remove();$(this).popover("hide")});$(".icon-calendar").on("click",function(){$(this).closest("div").children('input[type="text"]').datetimepicker("show")});$("#postRideForm").validate({ignore:":hidden .ignore",focusInvalid:false,focusCleanup:true,onfocusout:function(e){if(!$(e).is("select")&&e.value===""&&e.defaultValue===""){$(e).valid()}if($(e).valid()){$(e).removeClass("error").addClass("success")}else{$(e).removeClass("success").addClass("error")}},showErrors:function(e,t){$.each(this.successList,function(e,t){return $(t).popover("hide")});return $.each(t,function(e,t){getErrorPopupTemplate(t,"right")})},rules:{toLocation:{required:true},datePostRide:{required:true,date:false},seats:{required:true}},messages:{toLocation:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","destination location")},datePostRide:{required:VALIDATION_ERROR_MSG_SELECT.replace("{element}","date")},seats:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","free seats")}},invalidHandler:function(e,t){if(t.numberOfInvalids()){return false}},submitHandler:function(e){$("#editRideLoader").removeClass("hide");$("#postRide").attr("disabled","disabled");postRide()}})});$(window).on("load",function(){$("#searchLocation").getSlider("locationRange"," Miles");$("#locationRange").html($("#searchLocation").slider("value")+" Miles");airportName=$("#startLocationSelect").css("display")!="none"?$("option:selected","#startLocation").val():$("option:selected","#toStartLocation").val();driverAddress=$("#toLocationInput").is(":visible")?$("#toLocation").val():$("#startToLocation").val();$("#contribution").getSlider("contributionPrice",null,"$");$.validator.addMethod("minStrict",function(e,t,n){e=(new Date($("#requestRideDateTime").val())).getTime();return e>n});$("#date").rules("add",{required:true,minStrict:(new Date).getTime(),messages:{required:"please enter time",minStrict:jQuery.format("Time should  be greater than current time")}});$("#contribution").slider("option","disabled",true);$("#contribution").slider("value",0);$("#maxPrice").text("$")})