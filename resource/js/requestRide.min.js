function postALift(){var e=$("#startLocationFrom").css("display")!="none"?$("option:selected","#fromLocationRequestRide").val():$("#fromLocation").val();var t=$("#toLocationFrom").is(":visible")?$("#toLocation").val():$("option:selected","#toLocationRequestRide").val();var n=$("#startLocationFrom").css("display")!="none"?AIRPORT_START:ADDRESS_START;var r=sessionManager("getSession","customerId");if(r){var i=$.getDateTime.date($("#requestRideDateTime").val());var s=$.getDateTime.time($("#requestRideDateTime").val());s=$.getDateTime.time(s,true);var o={customerId:r,date:i,time:s,start:e,to:t,startType:n,via:"",maxMiles:"",seats:$("#seatsRequestRide option:selected").val(),smoker:$("#smoker").is(":checked"),bags:$("#bagRequestRide").val(),bagSize:$("#requestRideBagSizeSelect option:selected").val(),note:$("#liftNote").val()};var u={action:POST_A_LIFT,lift:JSON.stringify(o)};$.ajax({type:"POST",url:CUSTOM_API_URL,data:u,dataType:"json",headers:HEADER,async:false,error:function(e){showAlertBox("Error",ERROR_MSG)},success:function(e){if(e.retCode){var t="Your request for a ride";t+=" has been registered successfully.";showAlertBox("Successful",t,SITE_URL+"requestRide.php")}}})}moveTotop()}function moveTotop(){$("html, body").animate({scrollTop:0},"slow");$(window).scroll(function(){$(window).scrollTop()})}function showPreviousLifts(){var e=sessionManager("getSession","customerId");if(e){var t=liftsByCustomer(e);var n=t.lifts==null||t.lifts.length==1;loadPreviousLifts(t);$("#requestRidePanel").contentSlider("My Offers",n,$.session.get("selectedTab"))}}function loadPreviousLifts(e){var t="";if(e.retCode&&e.lifts.length>0){e=sortByKey(e.lifts,"dt","0");$.each(e,function(e,n){var r=$.getDateTime.formatDate(n.dt);var i=n.maxMiles==null?"-":n.maxMiles+" Miles";var s=n.status==PENDING_PAYMENT;var o=n.status==PENDING_CONFIRM;var u=$.getDateTime.formatDateTime(n.dt);var a=n.startType==AIRPORT_START?"Airport":"Address";var f=n.startType==ADDRESS_START?"Airport":"Address";var l=n.smoker==1?"Yes":"No";t+='<div><h2 class="title greenLabel">'+r+"</h2>";t+='<table class="table table-striped"><tr>';if(o){t+="<td>";t+='<a href="#" class="confirmLift"';t+=' liftId="'+n.id+'">Confirm';t+="</a>";t+="</td>"}if(s){t+='<td><a href="#"';t+=' class="pay" liftId="'+n.id+'">Pay</a>';t+="</td>"}t+="</tr><tr><td>Date</td><td>"+u+"</td></tr>";t+="<tr><td>"+a+"";t+="</td><td>"+n.start+"</td></tr>";t+="<tr><td>"+f+"</td><td>"+n.to+"</td></tr>";t+="<tr><td>Seats</td><td>"+n.seats+"</td></tr>";t+="<tr><td>Smoker</td><td>"+l+"</td></tr>";t+="<tr><td>Bags</td><td>"+n.bags+"</td></tr>";t+="<tr><td>Status</td><td>"+getLiftStatusName(n.status);t+="<tr><td>Bag Size</td><td>"+getBagSizeName(n.bagSize)+"</td></tr>";t+="<tr><td>Note</td><td>"+n.note+"</td></tr>";t+="</td></tr></tr></table></div>"})}else{t='<div><h2 class="greenLabel">No lift is found.</h2></div>'}$("#requestRidePanel").append(t)}function getLiftStatusName(e){var t="";switch(e){case"0":t="New Lift";break;case"1":t="Pending Confirm";break;case"2":t="Pending Payment";break;case"3":t="Fulfilled";break}return t}function bindSelectBox(e,t){$.each(t,function(t,n){$("#"+e).append('<option value="'+t+'">'+n+"</option>")});$("#"+e).select2()}function bindStateBox(){var e={action:GET_REGIONS_FOR_COUNTRY,countryCode:COUNTRY_NAME};$.ajax({type:"POST",url:API_URL,data:e,dataType:"json",headers:HEADER,async:false,error:function(e){return false},success:function(e){if(e.retCode){e=e.regions||e.entities;$.each(e,function(e,t){$("#state").append('<option value="'+t.code+'">'+t.name+"</option>")})}}});$("#state").select2()}$(function(){function t(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(t){var n=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);e.setBounds(new google.maps.LatLngBounds(n,n))})}}$(window).keydown(function(e){if(e.keyCode==13){e.preventDefault();return false}});showPreviousLifts();var e;initializeModal("paymentModal");$("#requestRideBagSizeSelect").select2();$("#seatsRequestRide").select2();getSeats("seatsRequestRide");if($("#toLocationFrom").css("display")!="none"){e=new google.maps.places.Autocomplete(document.getElementById("toLocation"),{types:["geocode"]})}e=new google.maps.places.Autocomplete(document.getElementById("fromLocation"),{types:["geocode"]});google.maps.event.addListener(e,"place_changed",function(){});$("#toLocation,#fromLocation").keyup(function(e){t()});$("#viaLocation").attr("disabled","disabled");var n=[{id:"requestRide"},{id:"myLiftsRequestRide"}];initializeModal("paymentModal");bindSelectBox("ccExpMonth",months);bindCustomSelectBox("ccExpYear",years);bindCustomSelectBox("ccType",cardTypes);bindStateBox();$('[rel="tooltip"]').tooltip();toggleSection(n);getLocation("fromLocationRequestRide",true);getLocation("toLocationRequestRide",true);getBagTypes("requestRideBagSizeSelect");$("#toLocation").filterType("special");$("#viaLocation").filterType("special");$("#seatsRequestRide").filterType("numeric");$("#requestRideDateTime").dateTimePicker();$("#requestRideDateTime").on("click",function(){$(this).next(".popover").remove();$(this).popover("hide")});$(".icon-minus-sign, .icon-plus-sign").on("click",function(){$(this).toggleClass("icon-minus-sign icon-plus-sign");$("#requestRideContainer").slideToggle(200,"linear");return false});$("#toLocation,#fromLocation").keyup(function(){if($("#toLocation").val().length>0||$("#fromLocation").val().length>0){$("#viaLocation").attr("disabled",false)}else{$("#viaLocation").attr("disabled","disabled")}});$(document).on("click",".confirmLift",function(){var e=pendingPaymentLift($(this).attr("liftId"));if(e){var t="Lift status has been changed to pending payment.";t+=" Please pay to confirm the lift.";showAlertBox("Confirmation Alert",t,SITE_URL+"requestRide.php")}else{showAlertBox("Error",ERROR_MSG)}moveTotop();return false});$(document).on("click",".exchange",function(){$("#startLocationFrom,#startLocationTo,#toLocationFrom,#toLocationAirport").toggleClass("hide");$("#startLocationTo .postRideLocationInput,#toLocationFrom .postRideLocationInput").toggleClass("ignore");var e=$("#fromLocationRequestRide option:selected").val();var t=$("#toLocation").val();var n=$("#toLocationRequestRide option:selected").val();var r=$("#fromLocation").val();$("#fromLocation").val(t);$("#toLocationRequestRide").select2("val",e);$("#fromLocationRequestRide").select2("val",n);$("#toLocation").val(r);if(!$("#fromLocation").hasClass("ignore")){$("#startLabel").html("Address");$("#toLabel").html("Airport")}else{$("#startLabel").html("Airport");$("#toLabel").html("Address")}return false});$(document).on("click",".pay",function(){$.session.set("liftId",$(this).attr("liftId"));var e=getLiftById($.session.get("liftId"));if(!e.retCode||e.lift==null||e.lift.rideId<=0){$(".closeModal").closest("#paymentModal").modal("hide");var t="Please contact the customer support.";t+=" You can not pay untill it has a ride. ";showAlertBox("Error",t)}else{$.session.set("rideId",e.lift.rideId);$("#paymentModal").clearForm();$("#ccType").select2("val","");$("#ccExpMonth").select2("val","");$("#ccExpYear").select2("val","");$("#state").select2("val","");$("#processPayment").removeAttr("disabled");$("#paymentLoader").hide();var n=sessionManager("getSession","customerId");var r=getCustomerByCustomerId(n,true);var i=" <strong>";if($("response address1",r).text()){i+=$("response address1",r).text()+", "}if($("response address2",r).text()){i+=$("response address2",r).text()+","}if($("response city",r).text()){i+=$("response city",r).text()+", "}if($("response state",r).text()){i+=$("response state",r).text()+", "}if($("response country",r).text()){i+=$("response country",r).text()+", "}if($("response zipCode",r).text()){i+=$("response zipCode",r).text()}i+=" <strong>";$("#custAddress").html(i);$("#paymentModal").modal("show")}moveTotop();return false});$("#requestRideForm").validate({ignore:":hidden .ignore",focusInvalid:false,focusCleanup:true,onfocusout:function(e){if(!$(e).is("select")&&e.value===""&&e.defaultValue===""){$(e).valid()}if($(e).valid()){$(e).removeClass("error").addClass("success")}else{$(e).removeClass("success").addClass("error")}},showErrors:function(e,t){$.each(this.successList,function(e,t){return $(t).popover("hide")});return $.each(t,function(e,t){getErrorPopupTemplate(t,"right")})},rules:{fromLocation:{required:true},toLocation:{required:true},dateRequestRide:{required:true,date:false}},messages:{fromLocation:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","Start location")},toLocation:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","destination location")},dateRequestRide:{required:VALIDATION_ERROR_MSG_SELECT.replace("{element}","date")}},invalidHandler:function(e,t){if(t.numberOfInvalids()){return true}},submitHandler:function(e){$("#requestRideLoader").removeClass("hide");$("#requestRide").attr("disabled","disabled");postALift()}});$(".icon-calendar").on("click",function(){$(this).closest("div").children('input[type="text"]').datetimepicker("show");return false})});$(window).on("load",function(){$("#searchLocation").getSlider("requestRideRange"," Miles");$("#requestRideRange").html($("#searchLocation").slider("value")+" Miles");$.validator.addMethod("minStrict",function(e,t,n){e=(new Date($("#requestRideDateTime").val())).getTime();return e>n});$("#requestRideDateTime").rules("add",{required:true,minStrict:(new Date).getTime(),messages:{required:"please enter time",minStrict:jQuery.format("Time should be greater than current time")}})});$(function(){var e=$("#paymentForm").validate({ignore:":hidden .ignore",onfocusout:function(e){if(!$(e).is("select")&&e.value===""&&e.defaultValue===""){$(e).valid()}if($(e).valid()){$(e).removeClass("error").addClass("success")}else{$(e).removeClass("success").addClass("error")}},rules:{firstName:{required:true},lastName:{required:true},streetAddress:{required:true},city:{required:true},state:{required:true},zipCode:{required:true},ccNumber:{required:true},cvv:{required:true}},messages:{firstName:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","first Name")},lastName:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","last Name")},streetAddress:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","address")},city:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","city")},state:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","state")},zipCode:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","zip code")},ccNumber:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","credit card number")},cvv:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","cvv number")}},showErrors:function(e,t){return $.each(t,function(e,t){getErrorPopupTemplate(t)})},invalidHandler:function(e,t){if(t.numberOfInvalids()){return false}},submitHandler:function(e){$("#processPayment").attr("disabled","disabled");$("#paymentLoader").show();processPayment()}}).settings;e.rules.ccType={required:true};e.messages.ccType={required:VALIDATION_ERROR_MSG_SELECT.replace("{element}","card type")};e.rules.ccExpMonth={required:true};e.messages.ccExpMonth={required:VALIDATION_ERROR_MSG_SELECT.replace("{element}","expiry month")};e.rules.ccExpYear={required:true};e.messages.ccExpYear={required:VALIDATION_ERROR_MSG_SELECT.replace("{element}","expiry year")}});$(window).bind("beforeunload",function(){if($("#requestRidePanel-nav-select").is(":visible")){var e=$("#requestRidePanel-nav-select option:selected").val().split("tab")[1];$.session.set("selectedTab",e)}else{$("#requestRidePanel-nav-ul li").each(function(e,t){if($("a",this).hasClass("current")){var n=$("a",this).attr("href").split("#")[1];$.session.set("selectedTab",n)}})}})