function findRide(){var e="";var t="";var n=ADDRESS_START;if($("#fromSelect").hasClass("isShown")){e=$("option:selected","#fromSelect").val();t=$("#toAddressFindRide").val();n=AIRPORT_START}else if($("#locationFindRide").hasClass("isShown")){e=$("option:selected","#locationFindRide").val();t=$("#addressFindRide").val()}$.session.set("startType",n);$.session.set("locationFindRide",e);$.session.set("addressFindRide",t);$.session.set("dateFindRide",$.getDateTime.date($("#date").val()));var r=$("#smoker").prop("checked")?1:0;$.session.set("smokerFindRide",r);$.session.set("timeFindRide",$("#time").val());$.session.set("seatsFindRide",$("option:selected","#seatsFindRide").val());$.session.set("bagsFindRide",$("#bagsFindRide").val());$.session.set("bagSizeFindRide",$("option:selected","#bagSizeFindRide").val());$.session.clear("pageLocation");window.location=SITE_URL+"bookRide.php"}function ridesByCustomerId(){$("#from").autoComplete();var e=sessionManager("getSession","customerId");if(e){var t=liftsByCustomer(e);loadCustomerLifts(t)}else{$("#panelMyRide").addClass("hide")}}function loadCustomerLifts(e){$("#myFindRideContainer").empty();var t="";var n=e.lifts==null||e.lifts.length==1;if(e.retCode&&e.lifts.length>0){e=sortByKey(e.lifts,"dt","0");$.each(e,function(e,n){var r=n.status!=3;var i=$.getDateTime.formatDateTime(n.dt);var s=$.getDateTime.formatDate(n.dt);var o=getBagSizeName(n.bagSize);var u=n.startType==AIRPORT_START?"Airport":"Address";var a=n.startType==ADDRESS_START?"Airport":"Address";var f=n.smoker?"Yes":"No";t+='<div><h2 class="title greenLabel">'+s+"</h2>";t+='<table class="table table-striped">';if(r){t+='<tr><td width="105"><a href="#" class="selectRider"';t+=' liftId="'+n.id+'" date="'+n.dt+'"';t+=" startType="+n.startType;t+=' customerId="'+n.customerId+'"><i class="icon-th"></i>';t+=" Select Lift</a></td></tr>"}t+='<tr><td colspan="2">Date</td><td colspan="2" '+'class="date">'+i+"</td></tr>";t+="</td></tr>";t+='<tr><td colspan="2">'+u+'</td><td colspan="2" '+'class="start">'+n.start+"</td></tr>";t+='<tr><td colspan="2">'+a+'</td><td colspan="2" '+'class="to">'+n.to+"</td></tr>";t+='<tr><td colspan="2">Seats</td><td colspan="2" '+'class="seat">'+(n.seats||"-")+"</td></tr>";t+='<tr><td colspan="2">Bag Size</td><td colspan="2" '+'class="bagSize">'+o+"</td></tr>";t+='<tr><td colspan="2">Bags</td><td colspan="2" '+'class="bags">'+n.bags+"</td></tr>";t+='<tr><td colspan="2">Smoker</td><td  colspan="2" '+"smoker="+n.smoker+' class="smoker">'+f+"</td></tr>";t+='<tr><td colspan="2">Status</td><td colspan="2">'+getLiftStatusName(n.status)+"</td></tr>";t+='<tr><td colspan="2">Note</td>';t+='<td colspan="2" class="textBreak">'+(n.note||"-");t+="</td></tr>";t+="</table></div>"})}else{t+='<div><h2 class="greenLabel">No lift is found.</h2></div>'}$("#myFindRideContainer").append(t);$("#panelMyRide").removeClass("hide");$("#myFindRideContainer").contentSlider("My Lifts",n,$.session.get("selectedTabFindRide"))}function addValidationRules(){$.validator.addMethod("minStrict",function(e,t,n){var r=$("#date").val()+" "+$("#time").val();e=(new Date(r)).getTime();return e>n});$("#time").rules("add",{required:true,minStrict:(new Date).getTime(),messages:{required:"Please enter time",minStrict:jQuery.format("Time should be greater than current time")}})}function removeValidationRules(){$("#time").rules("remove","minStrict");$("#time").next(".popover").remove();$("#time").addClass("ignore");$("#time").removeClass("error")}function getLiftStatusName(e){var t="";switch(e){case"0":t="New Lift";break;case"1":t="Pending Confirm";break;case"2":t="Pending Payment";break;case"3":t="Fulfilled";break}return t}function validateForm(){$("#findRideform").validate({onfocusout:function(e){if(!$(e).is("select")&&e.value===""&&e.defaultValue===""){$(e).valid()}if(!$(e).hasClass("ignore")){if($(e).valid()){$(e).removeClass("error").addClass("success")}else{$(e).removeClass("success").addClass("error")}}},showErrors:function(e,t){$.each(this.successList,function(e,t){return $(t).popover("hide")});return $.each(t,function(e,t){getErrorPopupTemplate(t,"right")})},rules:{address:{required:true},date:{required:true},time:{required:true}},messages:{address:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","address")},date:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","date")},time:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","time")}},invalidHandler:function(e,t){if(t.numberOfInvalids()){return false}},submitHandler:function(e){findRide()}})}$(function(){function t(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(t){var n=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);e.setBounds(new google.maps.LatLngBounds(n,n))})}}var e;$.session.clear("hasLift");validateForm();getLocation("locationFindRide",true,true);getBagTypes("bagSizeFindRide");$("#bagSizeFindRide").select2();$("#seatsFindRide").select2();getSeats("seatsFindRide");if($("#toAddress").css("display")!="none"){e=new google.maps.places.Autocomplete(document.getElementById("toAddressFindRide"),{types:["geocode"]})}e=new google.maps.places.Autocomplete(document.getElementById("addressFindRide"),{types:["geocode"]});google.maps.event.addListener(e,"place_changed",function(){});$("#addressFindRide,#toAddressFindRide").keyup(function(e){t()});if($.session.get("pageLocation")){$(".locationFindRide").select2("val",$.session.get("pageLocation"));$.session.clear("addressFindRide")}getLocation("locationFindRide",true,false);$.session.clear("hasLift");$("#time").timePicker();$("#date").datePicker();$(".icon-time").on("click",function(){$("#time").timepicker("show")});if($.session.get("addressFindRide")!=null&&isLoggedIn()){if($.session.get("startType")==ADDRESS_START){if($("#toAddressFindRide").hasClass("isShown")){$("#fromLabelLoc,#addressFindRideFrom,#toLabelAdd,#toAddress").toggleClass("hide");$("#fromSelect,#addressFindRide,#locationFindRide,#toAddressFindRide").toggleClass("isShown")}$("#addressFindRide").val($.session.get("addressFindRide"));$("#locationFindRide").select2("val",$.session.get("locationFindRide"));$("#startLabel").html("Address");$("#toLabel").html("Airport")}else if($.session.get("startType")==AIRPORT_START){if($("#addressFindRide").hasClass("isShown")){$("#fromLabelLoc,#addressFindRideFrom,#toLabelAdd,#toAddress").toggleClass("hide");$("#fromSelect,#addressFindRide,#locationFindRide,#toAddressFindRide").toggleClass("isShown")}$("#toAddressFindRide").val($.session.get("addressFindRide"));$("#fromLabelLoc .airspndLocation").select2("val",$.session.get("locationFindRide"));$("#startLabel").html("Airport");$("#toLabel").html("Address")}$("#date").datePicker($.session.get("dateFindRide"));$("#seatsFindRide").select2("val",$.session.get("seatsFindRide"));$("#bagSizeFindRide").select2("val",$.session.get("bagSizeFindRide"));$("#bagsFindRide").val($.session.get("bagsFindRide"));$("#time").val($.session.get("timeFindRide"));$("#time").timePicker($.session.get("timeFindRide"));$("#smoker").prop("checked",parseInt($.session.get("smokerFindRide"))==1?true:false)}$("#date").on("click",function(e){$(this).next(".popover").remove();$(this).removeClass("error")});$("#date").on("blur",function(e){$(this).next(".popover").remove();$(this).removeClass("error")});$(document).on("click",".exchange",function(){$("#fromLabelLoc,#addressFindRideFrom,#toLabelAdd,#toAddress").toggleClass("hide");$("#addressFindRideFrom .airspndLocation,#toAddress .airspndLocation").toggleClass("ignore");$("#fromSelect,#addressFindRide,#locationFindRide,#toAddressFindRide").toggleClass("isShown");var e=$(".locationFindRide option:selected").val();var t=$("#addressFindRide").val();var n=$(".addressFindRide").val();var r=$("#locationFindRide option:selected").val();$(".locationFindRide").select2("val",r);$("#addressFindRide").val(n);$(".addressFindRide").val(t);$("#locationFindRide").select2("val",e);if(!$("#addressFindRide").hasClass("ignore")){$("#startLabel").html("Address");$("#toLabel").html("Airport")}else{$("#startLabel").html("Airport");$("#toLabel").html("Address")}return false});$(".icon-calendar add-on").on("click",function(){$(this).closest("div").children('input[type="text"]').datepicker("show")});ridesByCustomerId();$(document).on("click",".selectRider",function(e){var t=$(this).closest("table");var n=$(this).attr("startType");$.session.set("liftId",$(this).attr("liftId"));$.session.set("hasLift",true);var r=$(this).attr("date");$.session.set("dateFindRide",$.getDateTime.date(r));var i=$.getDateTime.formatDate(r);var s=$.getDateTime.formatTime(r);var o=(new Date).getTime();var u=(new Date(r)).getTime();if(u<o){addValidationRules();s=$.getDateTime.formatTime(new Date)}else{removeValidationRules()}var a=$(t).find(".start").html();var f=$(t).find(".to").html();var l=$(t).find(".via").html();var c=$(t).find(".bags").html();var h=$(t).find(".smoker").html();h=h=="Yes"?1:0;$.session.set("locationFindRide",a);$.session.set("addressFindRide",f);if(n==ADDRESS_START){if($("#toAddressFindRide").hasClass("isShown")){$("#fromLabelLoc,#addressFindRideFrom,#toLabelAdd,#toAddress").toggleClass("hide");$("#fromSelect,#addressFindRide,#locationFindRide,#toAddressFindRide").toggleClass("isShown")}$("#addressFindRide").val(a);$("#locationFindRide").select2("val",f);$("#startLabel").html("Address");$("#toLabel").html("Airport")}else if(n==AIRPORT_START){if($("#addressFindRide").hasClass("isShown")){$("#fromLabelLoc,#addressFindRideFrom,#toLabelAdd,#toAddress").toggleClass("hide");$("#fromSelect,#addressFindRide,#locationFindRide,#toAddressFindRide").toggleClass("isShown")}$("#toAddressFindRide").val(f);$("#fromSelect").select2("val",a);$("#startLabel").html("Airport");$("#toLabel").html("Address")}$("#date").datePicker(r);$("#bagsFindRide").val(c);$("#seatsFindRide").select2("val",$(".seat",t).text());$("#bagSizeFindRide").select2("val",getBagCode($(".bagSize",t).text().toLowerCase()));$("#time").val(s);$("#time").timePicker(s);$("#smoker").prop("checked",h);$(".popover","#findRideform").remove();$("#findRideform :input").each(function(e){$(this).removeClass("error")});e.preventDefault()})});$(window).on("load",function(){});$(window).bind("beforeunload",function(){if($("#myLiftsContainer-nav-select").is(":visible")){var e=$("#myLiftsContainer-nav-select option:selected").val().split("tab")[1];$.session.set("selectedTabFindRider",e)}else{$("#myFindRideContainer-nav-ul li").each(function(e,t){if($("a",this).hasClass("current")){var n=$("a",this).attr("href").split("#")[1];$.session.set("selectedTabFindRide",n)}})}})