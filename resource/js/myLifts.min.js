function myLifts(){var e=sessionManager("getSession","customerId");if(e){initializeModal("editLiftModal");getLocation("editLiftStartLocation");getLocation("editLiftStartLocationTo",true);$("#editLiftToLocation").filterType("special");$("#editLiftViaLocation").filterType("special");$("#editLiftSeat").filterType("numeric");$("#editLiftNote").filterType("special");$("#editLiftDateTime").datePicker();$("#editLiftTime").timePicker();$("#zipCode").filterType("numeric");$("#ccNumber").filterType("numeric");$("#cvv").filterType("numeric");$("#city").filterType("alpha");$("#firstNamePayment").filterType("alpha");$("#middleNamePayment").filterType("alpha");$("#lastNamePayment").filterType("alpha");initializeModal("paymentModal");bindSelectBox("ccExpMonth",months);bindCustomSelectBox("ccExpYear",years);bindCustomSelectBox("ccType",cardTypes);bindStateBox();var t=liftsByCustomer(e);loadMyLifts(t);var n=t.lifts==null||t.lifts.length==1||t.lifts.length==0;$("#myLiftsContainer").contentSlider("My Lifts",n,$.session.get("selectedTabMyLift"))}else{loadSignInModal()}}function loadMyLifts(e){var t="";var n={};if(e.retCode&&e.lifts.length>0){e=sortByKey(e.lifts,"dt","0");$.each(e,function(e,r){n[r.id]=r;var i=r.editable==1;var s=parseInt(r.ride.rideId)?true:false;var o=r.status==PENDING_CONFIRM;var u=r.status==PENDING_PAYMENT;var a=!s&&r.status==NEW_LIFT;var f=r.startType==AIRPORT_START?"Airport":"Address";var l=r.startType==ADDRESS_START?"Airport":"Address";var c=r.note||"-";var h=r.seats||"-";var p=r.smoker==true?"yes":"No";var d=$.getDateTime.formatDate(r.dt);var v=$.getDateTime.formatTime(r.dt);t+='<div><h2 class="title greenLabel">'+d+"</h2>";t+='<table class="table table-striped"><tbody>';t+='<tr class="tdHeader"><td width="105"><a href="#"';t+=' for="'+r.id+'"';t+='class="showRide"><i class="icon-th"></i>&nbsp;';t+="Show Rides</a></td><td colspan=2>";if(o){t+='<a href="#" class="confirmLift margin-right "';t+=' liftId="'+r.id+'">Confirm';t+="</a>"}if(u){t+='<a href="#"';t+=' class="pay" liftId="'+r.id+'">Pay</a>'}t+='</td><td class="pull" colspan=2>';if(i){t+='<a href="#" for="'+r.id+'"';t+=' customerId="'+r.customerId+'"';t+=" startType="+r.startType;t+=' class="editLift margin-right '+i+'">';t+='<i class="icon-pencil"></i>&nbsp;Edit</a>'}if(a){t+='<a href="#" for="'+r.id+'"';t+='customerId="'+r.customerId+'"';t+='class="deleteLift pull ">';t+='<i class="icon-trash"></i>&nbsp;Delete';t+="</a>"}t+="</td></tr>";t+="<tr><td colspan=2>Date</td><td colspan=2>"+d+"</td colspan=2></tr>";t+="<tr><td colspan=2>Time</td><td colspan=2>"+v+"</td colspan=2></tr>";t+="<tr><td colspan=2>"+f+"</td>";t+="<td colspan=2>"+r.start+"</td></tr><tr>";t+="<tr><td colspan=2>"+l+"</td><td colspan=2>"+r.to+"</td></tr>";t+="<tr><td colspan=2>Seats</td><td colspan=2>"+h+"</td></tr>";t+="<tr><td colspan=2>Smoker</td><td colspan=2>"+p+"</td></tr>";t+="<tr><td colspan=2>Status</td><td colspan=2>"+getLiftStatusName(r.status);t+="<tr><td colspan=2>Bags</td><td colspan=2>"+r.bags;t+="</td></tr>";t+="<tr><td colspan=2>Bag Size</td><td colspan=2>"+(getBagSizeName(r.bagSize)||"-")+"</td ></tr>";t+="<tr><td colspan=2>Note</td>";t+='<td class="textBreak" colspan=2>';t+=c+"</td></tr>";t+="</tbody></table></div>"});$.session.set("rideData",JSON.stringify(n))}else{t='<div><h2 class="greenLabel">No lift is found.</h2></div>'}$("#myLiftsContainer").append(t)}function updateLift(){var e=$("#startLocation").css("display")!="none"?$("option:selected","#editLiftStartLocation").val():$("#editLiftFromAddress").val();var t=$("#toLocation").is(":visible")?$("#editLiftToAddress").val():$("option:selected","#editLiftStartLocationTo").val();var n=$("#startLocation").css("display")!="none"?AIRPORT_START:ADDRESS_START;var r=$("#editLiftDateTime").val();var i=$.getDateTime.time($("#editLiftTime").val(),true);var s={id:$.session.get("liftId"),date:r,time:i,start:e,to:t,startType:n,via:"",maxMiles:"",seats:$("#editLiftSeat option:selected").val(),smoker:$("#smoker").is(":checked"),bags:$("#editLiftBags").val(),bagSize:$("#myLiftbagSizeSelect option:selected").val(),note:$("#editLiftNote").val()};var o={action:UPDATE_A_LIFT,lift:JSON.stringify(s)};$.ajax({type:"POST",url:CUSTOM_API_URL,data:o,dataType:"json",headers:HEADER,async:false,error:function(e){$("#editLiftLoader").addClass("hide");$("#updateLift").removeAttr("disabled");$("#editLiftModal").modal("hide");showAlertBox("Error",ERROR_MSG)},success:function(e){$("#editLiftLoader").addClass("hide");$("#updateLift").removeAttr("disabled");$("#editLiftModal").modal("hide");if(e.retCode){showAlertBox("Update Alert","Your changes have been saved.",SITE_URL+"myLifts.php")}}})}function deleteLift(e){var t={action:DELETE_A_LIFT,liftId:JSON.stringify(e)};$.ajax({type:"POST",url:CUSTOM_API_URL,data:t,dataType:"json",headers:HEADER,async:false,error:function(e){showAlertBox("Error",ERROR_MSG)},success:function(e){if(e.retCode){showAlertBox("Delete Alert","Your record has been deleted successfully.",SITE_URL+"myLifts.php")}}})}function loadAssignedRides(e){$("#rideAssignedContainer").empty();var t="";if(parseInt(e.ride.riderId)>0){var n=$.session.get("liftId");var r=e.ride;var i=r.firstName+" "+r.lastName;var s=r.rideId>0;var o=$.getDateTime.formatDate(r.dt);var u=$.getDateTime.formatTime(r.dt);if(s){t+='<tr class="confirmLiftRow '+s+'">';t+='<td colspan="99" class="pull-left">';t+='<label class="checkbox">';t+='<input type="checkbox" name="confirm" for="'+n+'"';t+=' id="confirmLift" />Confirm this lift.</label>';t+="</td></tr>"}t+="<tr><td>Name</td><td>"+i+"</td></tr>";t+="<tr><td>Email Id</td><td>"+r.email+"</td></tr>";t+="<tr><td>Phone</td><td>"+r.phone+"</td></tr>";t+="<tr><td>Date</td><td>"+o+"</td></tr>";t+="<tr><td>time</td><td>"+u+"</td></tr>";t+="<tr><td>Seats</td><td>"+r.seats+"</td></tr>";t+="<tr><td>Note</td><td >"+(r.notes||"-")+"</td>";t+="</tr>"}else{t+='<tr><td colspan="99"><h4 class="greenLabel">No ride is ';t+="assigned with this lift.</h4></td></tr>"}$("#rideAssignedContainer").append(t);$("#rideAssignedPanel").removeClass("hide")}function pendingConfirmALift(e){var t={action:PENDING_CONFIRM_A_LIFT,liftId:JSON.stringify(e)};$.ajax({type:"POST",url:CUSTOM_API_URL,data:t,dataType:"json",headers:HEADER,async:false,error:function(e){showAlertBox("Error",ERROR_MSG)},success:function(e){if(e.retCode){var t="Lift status has been comfirmed.";showAlertBox("Confirmation Alert",t,SITE_URL+"myLifts.php")}}})}function pendingPaymentALift(e){var t={action:PENDING_PAYMENT_A_LIFT,liftId:JSON.stringify(e)};$.ajax({type:"POST",url:CUSTOM_API_URL,data:t,dataType:"json",headers:HEADER,async:false,error:function(e){showAlertBox("Error",ERROR_MSG)},success:function(e){if(e.retCode){var t="Lift status has been changed to pending confirm.";t+=" Please pay to confirm the lift.";showAlertBox("Confirmation Alert",t,SITE_URL+"myLifts.php")}}})}function getLiftStatusName(e){var t="-";switch(e){case"0":t="New Lift";break;case"1":t="Pending Confirm";break;case"2":t="Pending Payment";break;case"3":t="Fulfilled";break}return t}function loadLiftInfo(e){var t=$.getDateTime.formatDate(e.dt);var n=$.getDateTime.formatTime(e.dt);var r=e.bags==null?0:e.bags;$("#editLiftDateTime").val(t);$("#editLiftDateTime").datePicker(t);var i=(new Date).getTime();var s=(new Date(e.dt)).getTime();if(s<i){n=$.getDateTime.formatTime(new Date)}$("#editLiftForm").find("input").each(function(){if($(this).hasClass("error")){$(this).removeClass("error")}});$("#editLiftTime").val(n);$("#editLiftTime").timePicker(n);$("#editLiftViaLocation").val(e.via);$("#editLiftSeat").select2("val",e.seats);$("#editLiftNote").val(e.note);$("#editLiftBags").val(r);$("#myLiftbagSizeSelect").select2("val",e.bagSize);$("#smoker").prop("checked",e.smoker);if(e.startType==ADDRESS_START){if($("#editLiftToAddress").hasClass("isShown")){$("#startLocation,#toLocationStart,#toLocation,#toStartLocation").toggleClass("hide");$("#editLiftStartLocation,#editLiftFromAddress,#editLiftToAddress,#editLiftStartLocationTo").toggleClass("isShown");$("#toLocationStart .myLiftLocationInput,#toLocation .myLiftLocationInput").toggleClass("ignore")}$("#editLiftFromAddress").val(e.start);$("#editLiftStartLocationTo").select2("val",e.to);$("#startLabel").html("Address");$("#toLabel").html("Airport")}else if(e.startType==AIRPORT_START){if($("#editLiftFromAddress").hasClass("isShown")){$("#startLocation,#toLocationStart,#toLocation,#toStartLocation").toggleClass("hide");$("#editLiftStartLocation,#editLiftFromAddress,#editLiftToAddress,#editLiftStartLocationTo").toggleClass("isShown");$("#toLocationStart .myLiftLocationInput,#toLocation .myLiftLocationInput").toggleClass("ignore")}$("#editLiftStartLocation").select2("val",e.start);$("#editLiftToAddress").val(e.to);$("#startLabel").html("Airport");$("#toLabel").html("Address")}var o=e.smoker==1?"checked":"";$("#smoker").prop("checked",o);var u=e.maxMiles||30;$("#editLiftLocation").getSlider("editLiftRange"," Miles",null,u);$("#editLiftRange").html($("#editLiftLocation").slider("value")+" Miles");$.validator.addMethod("minStrict",function(e,t,n){var r=$("#editLiftDateTime").val()+" "+$("#editLiftTime").val();e=(new Date(r)).getTime();return e>n});$("#editLiftTime").rules("add",{required:true,minStrict:(new Date).getTime(),messages:{required:"Please enter time",minStrict:jQuery.format("Time should  be greater than current time")}})}function bindStateBox(){var e={action:GET_REGIONS_FOR_COUNTRY,countryCode:COUNTRY_NAME};$.ajax({type:"POST",url:API_URL,data:e,dataType:"json",headers:HEADER,async:false,error:function(e){return false},success:function(e){if(e.retCode){e=e.entities||e.regions;$.each(e,function(e,t){$("#state").append('<option value="'+t.code+'">'+t.name+"</option>")})}}});$("#state").select2()}function bindSelectBox(e,t){$.each(t,function(t,n){$("#"+e).append('<option value="'+t+'">'+n+"</option>")});$("#"+e).select2()}$(function(){function t(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(t){var n=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);e.setBounds(new google.maps.LatLngBounds(n,n))})}}$(window).keydown(function(e){if(e.keyCode==13){e.preventDefault();return false}});myLifts();var e;$("#myLiftbagSizeSelect").select2();$("#editLiftSeat").select2();getSeats("editLiftSeat");getBagTypes("myLiftbagSizeSelect");$("#editLiftToLocation,#editLiftToStartLocation").keyup(function(e){t()});e=new google.maps.places.Autocomplete(document.getElementById("editLiftToAddress"),{types:["geocode"]});e=new google.maps.places.Autocomplete(document.getElementById("editLiftFromAddress"),{types:["geocode"]});google.maps.event.addListener(e,"place_changed",function(){});$('[rel="tooltip"]').tooltip();var n=$("#paymentForm").validate({ignore:":hidden .ignore",onfocusout:function(e){if(!$(e).is("select")&&e.value===""&&e.defaultValue===""){$(e).valid()}if($(e).valid()){$(e).removeClass("error").addClass("success")}else{$(e).removeClass("success").addClass("error")}},rules:{firstName:{required:true},lastName:{required:true},streetAddress:{required:true},city:{required:true},state:{required:true},zipCode:{required:true},ccNumber:{required:true},cvv:{required:true}},messages:{firstName:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","first Name")},lastName:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","last Name")},streetAddress:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","address")},city:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","city")},state:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","state")},zipCode:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","zip code")},ccNumber:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","credit card number")},cvv:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","cvv number")}},showErrors:function(e,t){return $.each(t,function(e,t){getErrorPopupTemplate(t)})},invalidHandler:function(e,t){if(t.numberOfInvalids()){return false}},submitHandler:function(e){$("#processPayment").attr("disabled","disabled");$("#paymentLoader").show();processPayment()}}).settings;n.rules.membershipType={required:true};n.rules.ccType={required:true};n.messages.ccType={required:VALIDATION_ERROR_MSG_SELECT.replace("{element}","card type")};n.rules.ccExpMonth={required:true};n.messages.ccExpMonth={required:VALIDATION_ERROR_MSG_SELECT.replace("{element}","expiry month")};n.rules.ccExpYear={required:true};n.messages.ccExpYear={required:VALIDATION_ERROR_MSG_SELECT.replace("{element}","expiry year")};$(".closeModal").on("click",function(){$("#editLiftModal").modal("hide");$(".popover").remove()});$(document).on("click",".exchange",function(){$("#startLocation,#toLocationStart,#toLocation,#toStartLocation").toggleClass("hide");$("#editLiftStartLocation,#editLiftFromAddress,#editLiftToAddress,#editLiftStartLocationTo").toggleClass("isShown");$("#toLocationStart .myLiftLocationInput,#toLocation .myLiftLocationInput").toggleClass("ignore");var e=$("#editLiftStartLocation option:selected").val();var t=$("#editLiftFromAddress").val();var n=$("#editLiftToAddress").val();var r=$("#editLiftStartLocationTo option:selected").val();$("#editLiftStartLocationTo").select2("val",e);$("#editLiftFromAddress").val(n);$("#editLiftToAddress").val(t);$("#editLiftStartLocation ").select2("val",r);if(!$("#editLiftFromAddress").hasClass("ignore")){$("#startLabel").html("Address");$("#toLabel").html("Airport")}else{$("#startLabel").html("Airport");$("#toLabel").html("Address")}return false});$(document).on("click",".confirmLift",function(){var e=pendingPaymentLift($(this).attr("liftId"));if(e){var t="Lift status has been changed to pending ";t+="payment. Please pay to confirm the lift.";showAlertBox("Confirmation Alert",t,SITE_URL+"myLifts.php")}else{showAlertBox("Error",ERROR_MSG)}return false});$(document).on("click",".pay",function(){$.session.set("liftId",$(this).attr("liftId"));var e=getLiftById($.session.get("liftId"));if(!e.retCode||e.lift==null||e.lift.rideId<=0){$(".closeModal").closest("#paymentModal").modal("hide");var t="Please contact the customer support.";t+=" You can not pay untill it has a ride. ";showAlertBox("Error",t)}else{$.session.set("rideId",e.lift.rideId);$("#paymentModal").clearForm();$("#ccType").select2("val","");$("#ccExpMonth").select2("val","");$("#ccExpYear").select2("val","");$("#state").select2("val","");$("#processPayment").removeAttr("disabled");$("#paymentLoader").hide();var n=sessionManager("getSession","customerId");var r=getCustomerByCustomerId(n,true);var i=" <strong>";if($("response address1",r).text()){i+=$("response address1",r).text()+", "}if($("response address2",r).text()){i+=$("response address2",r).text()+","}if($("response city",r).text()){i+=$("response city",r).text()+", "}if($("response state",r).text()){i+=$("response state",r).text()+", "}if($("response country",r).text()){i+=$("response country",r).text()+", "}if($("response zipCode",r).text()){i+=$("response zipCode",r).text()}i+=" <strong>";$("#custAddress").html(i);$("#paymentModal").modal("show")}});$(document).on("click",".editLift",function(){var e=JSON.parse($.session.get("rideData"));$.session.set("liftId",$(this).attr("for"));loadLiftInfo(e[$(this).attr("for")]);moveTotop();$("#editLiftModal").modal("show");return false});$(document).on("click",".showRide",function(){$.session.set("liftId",$(this).attr("for"));var e=JSON.parse($.session.get("rideData"));loadAssignedRides(e[$(this).attr("for")]);return false});$("#requestRideDateTime").dateTimePicker();$(".icon-calendar").on("click",function(){$(this).closest("div").children('input[type="text"]').datetimepicker("show")});$(".add-on").on("click",function(){$("#editLiftTime").timepicker("show")});$(document).on("click",".editLift",function(){$.session.set("customerId",$(this).attr("for"));$("#editLiftModal").modal("show")});$(document).on("click",".deleteLift",function(){var e=$(this).attr("for");bootbox.confirm("Do you want to delete this record ?",function(t){if(t){deleteLift(e)}})});var r=$("#editLiftForm").validate({ignore:":hidden .ignore",focusInvalid:false,focusCleanup:true,onfocusout:function(e){if(!$(e).is("select")&&e.value===""&&e.defaultValue===""){$(e).valid()}if($(e).valid()){$(e).removeClass("error").addClass("success")}else{$(e).removeClass("success").addClass("error")}},showErrors:function(e,t){$.each(this.successList,function(e,t){return $(t).popover("hide")});return $.each(t,function(e,t){getErrorPopupTemplate(t)})},rules:{editLiftDateTime:{required:true,date:false},editLiftTime:{required:true,date:false},editLiftToAddress:{required:true},editLiftFromAddress:{required:true},editLiftViaLocation:{required:true},editLiftSeat:{required:true}},messages:{editLiftDateTime:{required:VALIDATION_ERROR_MSG_SELECT.replace("{element}","date")},editLiftTime:{required:VALIDATION_ERROR_MSG_SELECT.replace("{element}","time")},editLiftToAddress:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","drop off point")},editLiftFromAddress:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","pick up point")},editLiftViaLocation:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","via point")},editLiftSeat:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","seat required")}},invalidHandler:function(e,t){if(t.numberOfInvalids()){return false}},submitHandler:function(e){$("#editLiftLoader").removeClass("hide");$("#updateLift").attr("disabled","disabled");updateLift()}}).settings;r.rules.editLiftStartLocation={required:true};r.messages.editLiftStartLocation={required:VALIDATION_ERROR_MSG_SELECT.replace("{element}","pick up point")}});$(window).on("beforeunload",function(){if($("#myLiftsContainer-nav-select").is(":visible")){var e=$("#myLiftsContainer-nav-select option:selected").val().split("tab")[1];$.session.set("selectedTabMyLift",e)}else{$("#myLiftsContainer-nav-ul li").each(function(e,t){if($("a",this).hasClass("current")){var n=$("a",this).attr("href").split("#")[1];$.session.set("selectedTabMyLift",n)}})}})