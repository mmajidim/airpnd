function searchLift(){var e="";var t="";var n=ADDRESS_START;if($("#fromSelect").hasClass("isShown")){e=$("option:selected","#fromSelect").val();t=$("#geoLocation").val();n=AIRPORT_START}else if($("#addressFindRider").hasClass("isShown")){e=$("option:selected","#locationFindRider").val();t=$("#addressFindRider").val()}$.session.set("addressType",n);$.session.set("locationFindRider",e);$.session.set("addressFindRider",t);$.session.set("dateFindRider",$.getDateTime.date($("#date").val()));$.session.set("timeFindRider",$("#time").val());var r=$("#smoker").prop("checked")?1:0;$.session.set("smokerFindRider",r);$.session.set("seatsFindRider",$("option:selected","#seatsFindRider").val());$.session.set("bagSizeFindRider",$("option:selected","#bagSizeSelect").val());$.session.set("bagsFindRider",$("#bagsFindRider").val());$.session.clear("pageLocation");window.location=SITE_URL+"bookRider.php"}function getMyRides(){var e=sessionManager("getSession","customerId");var t=rideByCustomer(e);var n="";var r=t.lifts==null||t.lifts.length==1;if(t.retCode&&t.rides.length>0){var i=sortByKey(t.rides,"dt","0");$.each(i,function(e,t){var r=t.status!=2;var i=$.getDateTime.formatDate(t.dt);var s=$.getDateTime.formatDateTime(t.dt);var o=getBagSizeName(t.bagSize);var u=t.startType==AIRPORT_START?"Airport":"Address";var a=t.startType==ADDRESS_START?"Airport":"Address";var f=t.via==null||t.via==""?"NA":t.via;var l=t.bags==null?0:t.bags;var c=t.smoker==1?"Yes":"No";n+='<div><h2 class="title greenLabel">'+i+"</h2>";n+='<table class="table table-striped">';if(r){n+='<tr><td colspan="99">';n+='<a href="#" class="selectRide '+r+'"';n+=' rideId="'+t.id+'" date="'+t.dt+'"';n+=" startType="+t.startType;n+=' customerId="'+t.customerId+'">';n+='<i class="icon-th"></i>';n+=" Select Ride</a></td></tr>"}n+='<tr><td colspan="2">Date</td><td  colspan="2" '+'class="dateTime">'+s+"</td></tr>";n+='<tr><td colspan="2">'+u+'</td><td colspan="2" '+'class="start">'+t.start+"</td></tr>";n+='<tr><td colspan="2">Via</td><td colspan="2" '+'class="via">'+f+"</td></tr>";n+='<tr><td colspan="2">'+a+'</td><td colspan="2" '+'class="to">'+t.to+"</td></tr>";n+='<tr><td colspan="2">Seats</td><td colspan="2" '+'class="seat">'+t.seats+"</td></tr>";n+='<tr><td colspan="2">Bag Size</td><td colspan="2" '+'class="bagSize">'+o+"</td></tr>";n+='<tr><td colspan="2">Bags</td><td colspan="2" '+'class="bags">'+l+"</td></tr>";n+='<tr><td colspan="2">Smoker</td><td colspan="2" '+'class="smoker">'+c+"</td></tr>";n+='<tr><td colspan="2">Status</td><td colspan="2">'+getStatusName(t.status)+"</td></tr>";n+='<tr><td colspan="2">Note</td><td colspan="2"  '+'class="textBreak">'+(t.note||"-")+"</td></tr>";n+="</table></div>"})}else{n+='<div><h2 class="greenLabel">No ride is found</h2>';n+="</div>"}$("#myLiftsContainer").append(n);$("#panelMyLift").removeClass("hide");$("#myLiftsContainer").contentSlider("My Rides",r,$.session.get("selectedTabFindRider"))}function addValidationRules(){$.validator.addMethod("minStrict",function(e,t,n){var r=$("#date").val()+" "+$("#time").val();e=(new Date(r)).getTime();return e>n});$("#time").rules("add",{required:true,minStrict:(new Date).getTime(),messages:{required:"Please enter time",minStrict:jQuery.format("Time should  be greater than current time")}})}function removeValidationRules(){$("#time").rules("remove","minStrict");$("#time").next(".popover").remove();$("#time").addClass("ignore");$("#time").removeClass("error")}function isLoggedInUser(){$("#from,#to").autoComplete();var e=sessionManager("getSession","user");if(e){getMyRides()}else{$("#panelMyLift").addClass("hide")}}function getStatusName(e){var t="";switch(parseInt(e)){case 0:t="New Ride";break;case 1:t="Pending";break;case 2:t="Full";break}return t}function validateForm(){$("#findRiderform").validate({onfocusout:function(e){if(!$(e).is("select")&&e.value===""&&e.defaultValue===""){$(e).valid()}if(!$(e).hasClass("ignore")){if($(e).valid()){$(e).removeClass("error").addClass("success")}else{$(e).removeClass("success").addClass("error")}}},showErrors:function(e,t){$.each(this.successList,function(e,t){return $(t).popover("hide")});return $.each(t,function(e,t){getErrorPopupTemplate(t,"right")})},rules:{address:{required:true},geoLocation:{required:true},date:{required:true},time:{required:true},seatsFindRider:{required:true}},messages:{address:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","address ")},geoLocation:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","address ")},date:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","date")},time:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","time")},seatsFindRider:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","seats")}},invalidHandler:function(e,t){if(t.numberOfInvalids()){return false}},submitHandler:function(e){searchLift()}})}$(function(){function t(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(t){var n=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);e.setBounds(new google.maps.LatLngBounds(n,n))})}}$(window).keydown(function(e){if(e.keyCode==13){e.preventDefault();return false}});var e;$.session.clear("hasRide");validateForm();$("#bagSizeSelect").select2();$("#seatsFindRider").select2();getSeats("seatsFindRider");getBagTypes("bagSizeSelect");getLocation("locationFindRider",true,false);getLocation("locationFindRider",true,true);if($("#toAddress").css("display")!="none"){e=new google.maps.places.Autocomplete(document.getElementById("geoLocation"),{types:["geocode"]})}e=new google.maps.places.Autocomplete(document.getElementById("addressFindRider"),{types:["geocode"]});google.maps.event.addListener(e,"place_changed",function(){});var n=window.location.pathname.toLowerCase();if($.session.get("pageLocation")){$(".locationFindRider").select2("val",$.session.get("pageLocation"));$.session.clear("addressFindRider")}isLoggedInUser();$("#time").timePicker();$("#date").datePicker();var r=new Date;$.validator.addMethod("minStrict",function(e,t,n){e=$.getDateTime.time($("#time").val(),true).split(":")[1];return e>n});$("#time").rules("add",{required:true,minStrict:r.getMinutes(),messages:{required:"Required input",minStrict:jQuery.format("Please select correct time")}});$("#addressFindRider,.addressFindRider").keyup(function(e){t()});if($.session.get("addressFindRider")!=null&&isLoggedIn()){if($.session.get("addressType")==ADDRESS_START){if($("#geoLocation").hasClass("isShown")){$("#fromLabelLoc,#addressFindRiderFrom,#toLabelAdd,#toAddress").toggleClass("hide");$("#locationFindRider,#geoLocation,#addressFindRider,#fromSelect").toggleClass("isShown")}$("#addressFindRider").val($.session.get("addressFindRider"));$("#locationFindRider ").select2("val",$.session.get("locationFindRider"));$("#startLabel").html("Address");$("#toLabel").html("Airport")}else if($.session.get("addressType")==AIRPORT_START){if($("#addressFindRider").hasClass("isShown")){$("#fromLabelLoc,#addressFindRiderFrom,#toLabelAdd,#toAddress").toggleClass("hide");$("#locationFindRider,#geoLocation,#addressFindRider,#fromSelect").toggleClass("isShown")}$("#fromLabelLoc .airspndLocation").select2("val",$.session.get("locationFindRider"));$("#toAddress .addressFindRider").val($.session.get("addressFindRider"));$("#startLabel").html("Airport");$("#toLabel").html("Address")}$("#seatsFindRider").select2("val",$.session.get("seatsFindRider"));$("#bagSizeSelect").select2("val",$.session.get("bagSizeFindRider"));$("#date").datePicker($.session.get("dateFindRider"));$("#bagsFindRider").val($.session.get("bagsFindRider"));$("#time").val($.session.get("timeFindRider"));$("#time").timePicker($.session.get("timeFindRider"));$("#smoker").prop("checked",parseInt($.session.get("smokerFindRider"))==1?true:false)}$(".icon-time").on("click",function(){$("#time").timepicker("show")});$(".icon-calendar add-on").on("click",function(){$(this).closest("div").children('input[type="text"]').datepicker("show")});$("#date").on("click",function(e){$(this).next(".popover").remove();$(this).removeClass("error")});$("#date").on("blur",function(e){$(this).next(".popover").remove();$(this).removeClass("error")});$(document).on("click",".exchange",function(){$("#fromLabelLoc,#addressFindRiderFrom,#toLabelAdd,#toAddress").toggleClass("hide");$("#locationFindRider,#geoLocation,#addressFindRider,#fromSelect").toggleClass("isShown");$("#addressFindRiderFrom .airspndLocation,#toAddress .addressFindRider").toggleClass("ignore");var e=$(".locationFindRider option:selected").val();var t=$("#addressFindRider").val();var n=$(".addressFindRider").val();var r=$("#locationFindRider option:selected").val();$(".locationFindRider").select2("val",r);$("#addressFindRider").val(n);$(".addressFindRider").val(t);$("#locationFindRider").select2("val",e);if(!$("#addressFindRider").hasClass("ignore")){$("#startLabel").html("Address");$("#toLabel").html("Airport")}else{$("#startLabel").html("Airport");$("#toLabel").html("Address")}return false});$(document).on("click",".selectRide",function(e){var t=$(this).attr("startType");var n=$(this).closest("table");$.session.set("rideId",$(this).attr("rideId"));$.session.set("customerId",$(this).attr("customerId"));$.session.set("hasRide",true);var r=$(this).attr("date");var i=$.getDateTime.formatTime(r);$.session.set("dateFindRider",$.getDateTime.date(r));var s=$("tr .start",n).html();var o=$("tr .to",n).html();var u=$(n).find(".smoker").html();u=u=="Yes"?1:0;var a=(new Date).getTime();var f=(new Date(r)).getTime();if(f<a){addValidationRules();i=$.getDateTime.formatTime(new Date)}else{removeValidationRules()}if(t==ADDRESS_START){if($("#geoLocation").hasClass("isShown")){$("#fromLabelLoc,#addressFindRiderFrom,#toLabelAdd,#toAddress").toggleClass("hide");$("#locationFindRider,#geoLocation,#addressFindRider,#fromSelect").toggleClass("isShown")}$("#addressFindRiderFrom .airspndLocation").val(s);$("#toLabelAdd .airspndLocation").select2("val",o);$("#startLabel").html("Address");$("#toLabel").html("Airport")}else if(t==AIRPORT_START){if($("#addressFindRider").hasClass("isShown")){$("#fromLabelLoc,#addressFindRiderFrom,#toLabelAdd,#toAddress").toggleClass("hide");$("#locationFindRider,#geoLocation,#addressFindRider,#fromSelect").toggleClass("isShown")}$("#fromLabelLoc .airspndLocation").select2("val",s);$("#toAddress .addressFindRider").val(o);$("#startLabel").html("Airport");$("#toLabel").html("Address")}$("#seatsFindRider").select2("val",$(".seat",n).text());$("#bagsFindRider").val($(".bags",n).text());$("#bagSizeSelect").select2("val",getBagCode($(".bagSize",n).text().toLowerCase()));$("#date").datePicker(r);$("#time").val(i);$("#time").timePicker(i);$("#smoker").prop("checked",u);$(".popover","#findRiderform").remove();$("#findRiderform :input").each(function(e){$(this).removeClass("error")});e.preventDefault()})});$(window).on("load",function(){$("#findLocation").getSlider("findLocationRange"," Miles");$("#findLocationRange").html($("#findLocation").slider("value")+" Miles");$(".locationFindRide").select2("val",$.session.get("pageLocation"));addValidationRules()});$(window).bind("beforeunload",function(){if($("#myLiftsContainer-nav-select").is(":visible")){var e=$("#myLiftsContainer-nav-select option:selected").val().split("tab")[1];$.session.set("selectedTabFindRider",e)}else{$("#myLiftsContainer-nav-ul li").each(function(e,t){if($("a",this).hasClass("current")){var n=$("a",this).attr("href").split("#")[1];$.session.set("selectedTabFindRider",n)}})}})