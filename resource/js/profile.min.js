function loadProfile(){var e=sessionManager("getSession","user");var t=sessionManager("getSession","customerId");var n=getCustomerByCustomerId(t,true);var r=$("returnVal note",n).text().split(";");var i=r[0].split(":")[1];var s=i===("Y"||"y")?true:false;if(typeof e==undefined||e==null)return;if(r[1]!=undefined||null){}else{}var o=e.name!=null?e.name:e.firstName+" "+(e.middleName||"")+" "+e.lastName;$("#userFullNameProfilePage").html(o);$("#firstProfilePage").val(e.firstName||e.first_name);$("#middleProfilePage").val(e.middleName);$("#lastProfilePage").val(e.lastName||e.last_name);$("#emailIdProfilePage").html(e.email);$("#emailProfilePage").val(e.email);$("#contact").html(e.phone);$("#phoneNumber").val(e.phone);$("#smsAlert").html(!s?"No":"Yes");$("#sms").prop("checked",s);$("#notification").addClass("hide")}function updateUser(e,t,n,r,i){var s;var o=$("#passwordProfilePage").val().trim()!=""?true:false;var u=getEncode(r);if($("#passwordProfilePage").val().trim()!=""){var a=getEncode(i,u.iv);s={action:REGISTER_USER,userInfoId:e,role:CUSTOMER_OWNER_ROLE,iv:JSON.stringify(u.iv),encodeUN:JSON.stringify(u.activate),encodePass:JSON.stringify(a.activate),firstName:JSON.stringify(t),lastName:JSON.stringify(n),email:JSON.stringify(r),status:ACTIVE,genPass:false}}else{s={action:REGISTER_USER,userInfoId:e,role:CUSTOMER_OWNER_ROLE,iv:JSON.stringify(u.iv),encodeUN:JSON.stringify(u.activate),firstName:JSON.stringify(t),lastName:JSON.stringify(n),email:JSON.stringify(r),status:ACTIVE,genPass:false}}$.ajax({type:"POST",url:API_URL,data:s,dataType:"json",headers:HEADER,error:function(e){$("#loaderUpdateProfile").addClass("hide");showAlertBox("Error",ERROR_MSG)},success:function(e){if(e.retCode){var t=getByUserName(r);if(t.retCode&&t.user){sessionManager("setSession","user",t.user)}$("#loaderUpdateProfile").addClass("hide");$(".profileEdit,.labelData,.passwordField,.accountField").toggleClass("hide");showAlertBox("Success Alert","Your profile has been updated.",SITE_URL+"profile.php")}if(e.retCode==0){$("#loaderUpdateProfile").addClass("hide");$("#success").addClass("hide");$("#error").slideDown();$("#editMyProfile").html("Edit");$("#confirmMessage").slideDown()}}})}function updateUserProfile(){var e=$("#firstProfilePage").val();var t=$("#middleProfilePage").val();var n=$("#lastProfilePage").val();var r=$("#emailProfilePage").val();var i=$("#phoneNumber").val();var s=getNoteSection();var o=updateCustomer(e,t,n,i,r,s);if(o){var u=sessionManager("getSession","customerId");o=updateOwner(u,e,n,r,i,s);if(o.retCode){var a=sessionManager("getSession","user");updateUser(a.userInfoId,e,n,r,$("#passwordProfilePage").val())}else if(!o.retCode){$("#loaderUpdateProfile").addClass("hide");showAlertBox("Error","Owner update is failed.",SITE_URL+"profile.php")}}else if(o==0){$("#loaderUpdateProfile").addClass("hide");showAlertBox("Error","Customer update is failed.",SITE_URL+"profile.php")}}function getNoteSection(){var e=$("#sms").is(":checked")?"Y":"N";var t=String.format("SMS:{0}",e);return t}function toggleProfile(){var e="Edit";if($("#editMyProfile").text().toLowerCase()==="edit"){$("#notification").removeClass("hide");$("#userProfile").resetForm();loadProfile();e=""}$("#editMyProfile").html(e);$(".profileEdit,.labelData,.passwordField,.accountField").toggleClass("hide")}function updateCustomer(e,t,n,r,i,s){var o=sessionManager("getSession","customerId");var u=getCustomerByCustomerId(o,true);var a={id:o,firstName:e,middleName:t,lastName:n,phone1:r,email:i,note:s};var f=-1;var l={action:UPDATE_CUSTOMER,customer:JSON.stringify(a)};$.ajax({type:"POST",url:API_URL,data:l,dataType:"json",headers:HEADER,async:false,error:function(e){showAlertBox("Error",ERROR_MSG)},success:function(e){f=e.retCode}});return f}function updateOwner(e,t,n,r,i,s){var o;e=typeof e!=undefined||e!=null?e:"";var u={customerId:e,role:CUSTOMER_OWNER_ROLE,firstName:t,lastName:n,address1:"",address2:"",city:"",state:"",zipCode:"",country:"",email:r,phone1:i,phone2:"",fax:"",note:s||"",subscribed:""};var a={action:ADD_OWNER,owner:JSON.stringify(u)};$.ajax({type:"POST",url:API_URL,data:a,dataType:"json",headers:HEADER,async:false,error:function(e){o=-1},success:function(e){o=e}});return o}$(function(){var e=sessionManager("getSession","user");if(e){$(document).on("click","#editMyProfile,#cancelBtn",function(){$(".popover","#userProfile").remove();$("input").removeClass("error");$("#success").addClass("hide");$("#confirmMessage").css("display","none");toggleProfile()});$(".closeMessage").on("click",function(){$("#confirmMessage").slideUp("slow")});$(".account").on("click",function(){$("#accocuntName").text($(".account:checked").attr("data-for"))})}else{loadSignInModal()}});$(document).on("click","#sms",function(){$("#phoneNumber").toggleClass("ignore");if(!$(this).is(":checked")){$("#phoneNumber").next(".popover").remove();validatePhone=false}else{validatePhone=true}});$(document).on("click","#updateProfile",function(e){validatePhone=$("#sms").prop("checked")==true?true:false;if($("#passwordProfilePage").val()==""){passVal=true}if(validatePhone){$("#phoneNumber").rules("add",{required:true,messages:{required:"please enter phone number"}})}if(!validatePhone){$("#phoneNumber").rules("add",{required:false})}});window.onload=function(){loadProfile();var e=false;var t=false;$("#userProfile").validate({ignore:":hidden .ignore",onfocusout:function(e){if(!$(e).is("select")&&e.value===""&&e.defaultValue===""){$(e).valid()}if(!$(e).hasClass("ignore")){if($(e).valid()){$(e).removeClass("error").addClass("success")}else{$(e).removeClass("success").addClass("error")}}},showErrors:function(e,t){$.each(this.successList,function(e,t){return $(t).popover("hide")});return $.each(t,function(e,t){getErrorPopupTemplate(t,"right")})},rules:{firstName:{required:true},lastName:{required:true},confirmPassword:{required:e,equalTo:"#passwordProfilePage"},phoneNumber:{required:t}},messages:{firstName:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","first name")},lastName:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","last name")},confirmPassword:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","confirm password"),equalTo:"password does not match"},phoneNumber:{required:VALIDATION_ERROR_MSG_INPUT.replace("{element}","phone number")}},invalidHandler:function(e,t){if(t.numberOfInvalids()){return false}},submitHandler:function(e){$("#loaderUpdateProfile").removeClass("hide");updateUserProfile()}})}